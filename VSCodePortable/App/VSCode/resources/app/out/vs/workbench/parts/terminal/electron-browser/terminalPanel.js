/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
(function(){var e=["vs/nls!vs/workbench/parts/terminal/electron-browser/terminalInstance","vs/nls!vs/workbench/parts/terminal/electron-browser/terminalPanel","vs/workbench/parts/terminal/electron-browser/terminalInstance","require","exports","vs/base/browser/dom","vs/base/common/lifecycle","vs/platform/message/common/message","os","xterm","vs/base/common/winjs.base","vs/base/browser/keyboardEvent","vs/editor/common/config/commonEditorConfig","vs/workbench/parts/terminal/electron-browser/terminalPanel","vs/base/common/platform","vs/nls","vs/platform/theme/common/themes","vs/platform/configuration/common/configuration","vs/platform/contextview/browser/contextView","vs/platform/instantiation/common/instantiation","vs/platform/keybinding/common/keybinding","vs/platform/telemetry/common/telemetry","vs/workbench/parts/terminal/electron-browser/terminalConfigHelper","vs/workbench/parts/terminal/electron-browser/terminal","vs/workbench/services/themes/common/themeService","vs/platform/workspace/common/workspace","vs/workbench/parts/terminal/electron-browser/terminalActions","vs/workbench/browser/panel","vs/base/browser/ui/actionbar/actionbar","vs/base/browser/mouseEvent","vs/base/browser/builder"],t=function(t){for(var n=[],i=0,r=t.length;i<r;i++)n[i]=e[t[i]];return n};define(e[0],t([15,1]),function(e,t){return e.create("vs/workbench/parts/terminal/electron-browser/terminalInstance",t)}),define(e[2],t([3,4,5,6,0,8,9,7,11,12]),function(e,t,n,i,r,o,s,a,c,l){"use strict";var m=function(){function e(e,t,i,o,m,h,p,u,f,d){var v=this;this.terminalProcess=e,this.parentDomElement=t,this.contextMenuService=i,this.contextService=o,this.instantiationService=m,this.keybindingService=h,this.terminalService=p,this.messageService=u,this.terminalFocusContextKey=f,this.onExitCallback=d,this.isExiting=!1,this.skipTerminalKeybindings=[],this.toDispose=[],this.wrapperElement=document.createElement("div"),n.addClass(this.wrapperElement,"terminal-wrapper"),this.terminalDomElement=document.createElement("div"),this.xterm=s(),this.id=this.terminalProcess.process.pid,this.terminalProcess.process.on("message",function(e){"data"===e.type&&v.xterm.write(e.content)}),this.xterm.on("data",function(e){return v.terminalProcess.process.send({event:"input",data:v.sanitizeInput(e)}),!1}),this.xterm.attachCustomKeydownHandler(function(e){var t=new c.StandardKeyboardEvent(e);return v.skipTerminalKeybindings.some(function(e){return t.equals(e.value)})?(e.preventDefault(),!1):(!l.TabFocus.getTabFocusMode()||9!==e.keyCode)&&void 0}),this.terminalProcess.process.on("exit",function(e){v.isExiting||(v.isExiting=!0,v.dispose(),e&&v.messageService.show(a.Severity.Error,r.localize(0,null,e)),v.onExitCallback(v))}),this.xterm.open(this.terminalDomElement);var g=this.xterm.element.querySelector(".xterm-helpers"),y=document.createElement("div");y.setAttribute("tabindex","0"),n.addClass(y,"focus-trap"),y.addEventListener("focus",function(e){for(var t=y;!n.hasClass(t,"part");)t=t.parentElement;var i=t.querySelector(".hide-panel-action");i.focus()}),g.insertBefore(y,this.xterm.textarea),this.toDispose.push(n.addDisposableListener(this.xterm.textarea,"focus",function(e){v.terminalFocusContextKey.set(!0)})),this.toDispose.push(n.addDisposableListener(this.xterm.textarea,"blur",function(e){v.terminalFocusContextKey.reset()})),this.toDispose.push(n.addDisposableListener(this.xterm.element,"focus",function(e){v.terminalFocusContextKey.set(!0)})),this.toDispose.push(n.addDisposableListener(this.xterm.element,"blur",function(e){v.terminalFocusContextKey.reset()})),this.wrapperElement.appendChild(this.terminalDomElement),this.parentDomElement.appendChild(this.wrapperElement)}return e.prototype.sanitizeInput=function(t){return"string"==typeof t?t.replace(e.eolRegex,o.EOL):t},e.prototype.layout=function(e){if(this.font&&this.font.charWidth&&this.font.charHeight&&e.height){var t=parseInt(getComputedStyle(document.querySelector(".terminal-outer-container")).paddingLeft.split("px")[0],10),n=e.width-t,i=Math.floor(n/this.font.charWidth),r=Math.floor(e.height/this.font.charHeight);this.xterm&&(this.xterm.resize(i,r),this.xterm.element.style.width=n+"px"),this.terminalProcess.process.connected&&this.terminalProcess.process.send({event:"resize",cols:i,rows:r})}},e.prototype.toggleVisibility=function(e){n.toggleClass(this.wrapperElement,"active",e)},e.prototype.setFont=function(e){this.font=e},e.prototype.setCursorBlink=function(e){this.xterm&&this.xterm.cursorBlink!==e&&(this.xterm.cursorBlink=e,this.xterm.refresh(0,this.xterm.rows-1))},e.prototype.setCommandsToSkipShell=function(e){var t=this;this.skipTerminalKeybindings=e.map(function(e){return t.keybindingService.lookupKeybindings(e)}).reduce(function(e,t){return e.concat(t)})},e.prototype.sendText=function(e,t){t&&e.substr(e.length-o.EOL.length)!==o.EOL&&(e+=o.EOL),this.terminalProcess.process.send({event:"input",data:e})},e.prototype.focus=function(e){if(this.xterm){var t=window.getSelection().toString();t&&!e||this.xterm.focus()}},e.prototype.scrollDown=function(){this.xterm.scrollDisp(1)},e.prototype.scrollUp=function(){this.xterm.scrollDisp(-1)},e.prototype.dispose=function(){this.wrapperElement&&(this.parentDomElement.removeChild(this.wrapperElement),this.wrapperElement=null),this.xterm&&(this.xterm.destroy(),this.xterm=null),this.terminalProcess&&(this.terminalService.killTerminalProcess(this.terminalProcess),this.terminalProcess=null),this.toDispose=i.dispose(this.toDispose)},e.eolRegex=/\r?\n/g,e}();t.TerminalInstance=m});var n=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},r=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}};define(e[13],t([3,4,5,6,1,14,30,16,17,18,19,20,7,21,22,23,24,25,26,27,28,29,2,10]),function(e,t,o,s,a,c,l,m,h,p,u,f,d,v,g,y,x,b,I,S,w,T,E,C){"use strict";var D=function(e){function t(t,n,i,r,o,s,a,c,l){e.call(this,y.TERMINAL_PANEL_ID,t),this.configurationService=n,this.contextMenuService=i,this.instantiationService=r,this.keybindingService=o,this.contextService=s,this.terminalService=a,this.themeService=c,this.messageService=l,this.toDispose=[],this.terminalInstances=[]}return n(t,e),t.prototype.layout=function(e){e&&this.terminalInstances.forEach(function(t){t.layout(e)})},t.prototype.getActions=function(){var e=this;return this.actions||(this.actions=[this.instantiationService.createInstance(I.SwitchTerminalInstanceAction,I.SwitchTerminalInstanceAction.ID,I.SwitchTerminalInstanceAction.LABEL),this.instantiationService.createInstance(I.CreateNewTerminalAction,I.CreateNewTerminalAction.ID,I.CreateNewTerminalAction.PANEL_LABEL),this.instantiationService.createInstance(I.KillTerminalAction,I.KillTerminalAction.ID,I.KillTerminalAction.PANEL_LABEL)],this.actions.forEach(function(t){e.toDispose.push(t)})),this.actions},t.prototype.getContextMenuActions=function(){var e=this;return this.contextMenuActions||(this.contextMenuActions=[this.instantiationService.createInstance(I.CreateNewTerminalAction,I.CreateNewTerminalAction.ID,a.localize(0,null)),new w.Separator,this.instantiationService.createInstance(I.CopyTerminalSelectionAction,I.CopyTerminalSelectionAction.ID,a.localize(1,null)),this.instantiationService.createInstance(I.TerminalPasteAction,I.TerminalPasteAction.ID,a.localize(2,null))],this.contextMenuActions.forEach(function(t){e.toDispose.push(t)})),this.contextMenuActions},t.prototype.getActionItem=function(t){return t.id===I.SwitchTerminalInstanceAction.ID?this.instantiationService.createInstance(I.SwitchTerminalInstanceActionItem,t):e.prototype.getActionItem.call(this,t)},t.prototype.create=function(t){return e.prototype.create.call(this,t),this.parentDomElement=t.getHTMLElement(),this.terminalService.initConfigHelper(t),o.addClass(this.parentDomElement,"integrated-terminal"),this.themeStyleElement=document.createElement("style"),this.fontStyleElement=document.createElement("style"),this.terminalContainer=document.createElement("div"),o.addClass(this.terminalContainer,"terminal-outer-container"),this.parentDomElement.appendChild(this.themeStyleElement),this.parentDomElement.appendChild(this.fontStyleElement),this.parentDomElement.appendChild(this.terminalContainer),this.attachEventListeners(),this.configurationHelper=new g.TerminalConfigHelper(c.platform,this.configurationService,t),C.TPromise.as(void 0)},t.prototype.attachEventListeners=function(){var e=this;this.toDispose.push(o.addDisposableListener(this.parentDomElement,"mousedown",function(t){if(0!==e.terminalInstances.length)if(2===t.which&&c.isLinux)e.terminalInstances[e.terminalService.getActiveTerminalIndex()].focus(!0);else if(3===t.which){var n=e.parentDomElement;if(t instanceof MouseEvent){var i=new T.StandardMouseEvent(t);n={x:i.posx,y:i.posy}}e.contextMenuService.showContextMenu({getAnchor:function(){return n},getActions:function(){return C.TPromise.as(e.getContextMenuActions())},getActionsContext:function(){return e.parentDomElement},getKeyBinding:function(t){var n=e.keybindingService.lookupKeybindings(t.id);return n.length>0?n[0]:null}})}})),this.toDispose.push(o.addDisposableListener(this.parentDomElement,"mouseup",function(t){0!==e.terminalInstances.length&&3!==t.which&&e.terminalInstances[e.terminalService.getActiveTerminalIndex()].focus()})),this.toDispose.push(o.addDisposableListener(this.parentDomElement,"keyup",function(e){27===e.keyCode&&e.stopPropagation()}))},t.prototype.createNewTerminalInstance=function(e,t){var n=this;return this.createTerminal(e,t).then(function(e){return n.updateConfig(),n.focus(),C.TPromise.as(e.id)})},t.prototype.closeActiveTerminal=function(){return this.closeTerminal(this.terminalService.getActiveTerminalIndex())},t.prototype.closeTerminal=function(e){return this.onTerminalInstanceExit(this.terminalInstances[e]),C.TPromise.as(void 0)},t.prototype.closeTerminalById=function(e){return this.closeTerminal(this.getTerminalIndexFromId(e))},t.prototype.setVisible=function(t){var n=this;if(t){if(!(this.terminalInstances.length>0))return e.prototype.setVisible.call(this,t).then(function(){n.terminalService.createNew()});this.updateConfig(),this.updateTheme()}return e.prototype.setVisible.call(this,t)},t.prototype.sendTextToActiveTerminal=function(e,t){var n=this.terminalInstances[this.terminalService.getActiveTerminalIndex()];n.sendText(e,t)},t.prototype.createTerminal=function(e,t){var n=this;return new C.TPromise(function(i){var r=new E.TerminalInstance(e,n.terminalContainer,n.contextMenuService,n.contextService,n.instantiationService,n.keybindingService,n.terminalService,n.messageService,t,n.onTerminalInstanceExit.bind(n));n.terminalInstances.push(r),n.setActiveTerminal(n.terminalInstances.length-1),n.toDispose.push(n.themeService.onDidColorThemeChange(n.updateTheme.bind(n))),n.toDispose.push(n.configurationService.onDidUpdateConfiguration(n.updateConfig.bind(n))),n.updateTheme(),n.updateConfig(),i(r)})},t.prototype.setActiveTerminal=function(e){this.terminalInstances.forEach(function(t,n){t.toggleVisibility(n===e)})},t.prototype.getTerminalIndexFromId=function(e){var t=-1;if(this.terminalInstances.forEach(function(n,i){n.id===e&&(t=i)}),t===-1)throw new Error("Terminal with ID "+e+" does not exist (has it already been disposed?)");return t},t.prototype.onTerminalInstanceExit=function(e){var t=this.terminalInstances.indexOf(e);t!==-1&&(this.terminalInstances[t].dispose(),this.terminalInstances.splice(t,1)),this.terminalInstances.length>0&&this.setActiveTerminal(this.terminalService.getActiveTerminalIndex()),0===this.terminalInstances.length?this.terminalService.hide():this.terminalService.show(!0)},t.prototype.updateTheme=function(e){var t=this;e||(e=this.themeService.getColorTheme());var n=m.getBaseThemeId(e);if(n!==this.currentBaseThemeId){this.currentBaseThemeId=n;var i=this.configurationHelper.getTheme(n),r="";i.forEach(function(e,n){var i=t.convertHexCssColorToRgba(e,.996);r+=".monaco-workbench .panel.integrated-terminal .xterm .xterm-color-"+n+" { color: "+e+"; }"+(".monaco-workbench .panel.integrated-terminal .xterm .xterm-color-"+n+"::selection { background-color: "+i+"; }")+(".monaco-workbench .panel.integrated-terminal .xterm .xterm-bg-color-"+n+" { background-color: "+e+"; }")+(".monaco-workbench .panel.integrated-terminal .xterm .xterm-bg-color-"+n+"::selection { color: "+e+"; }")}),this.themeStyleElement.innerHTML=r}},t.prototype.scrollDown=function(){this.terminalInstances[this.terminalService.getActiveTerminalIndex()].scrollDown()},t.prototype.scrollUp=function(){this.terminalInstances[this.terminalService.getActiveTerminalIndex()].scrollUp()},t.prototype.convertHexCssColorToRgba=function(e,t){var n=parseInt(e.substr(1,2),16),i=parseInt(e.substr(3,2),16),r=parseInt(e.substr(5,2),16);return"rgba("+n+", "+i+", "+r+", "+t+")"},t.prototype.updateConfig=function(){this.updateFont(),this.updateCursorBlink(),this.updateCommandsToSkipShell()},t.prototype.updateFont=function(){if(0!==this.terminalInstances.length){var e=this.configurationHelper.getFont();o.toggleClass(this.parentDomElement,"enable-ligatures",this.configurationHelper.getFontLigaturesEnabled()),this.font&&!this.fontsDiffer(this.font,e)||(this.fontStyleElement.innerHTML=".monaco-workbench .panel.integrated-terminal .xterm {"+("font-family: "+e.fontFamily+";")+("font-size: "+e.fontSize+";")+("line-height: "+e.lineHeight+";")+"}",this.font=e),this.terminalInstances[this.terminalService.getActiveTerminalIndex()].setFont(e),this.layout(new l.Dimension(this.parentDomElement.offsetWidth,this.parentDomElement.offsetHeight))}},t.prototype.fontsDiffer=function(e,t){return e.charHeight!==t.charHeight||e.charWidth!==t.charWidth||e.fontFamily!==t.fontFamily||e.fontSize!==t.fontSize||e.lineHeight!==t.lineHeight},t.prototype.updateCursorBlink=function(){var e=this;this.terminalInstances.forEach(function(t){t.setCursorBlink(e.configurationHelper.getCursorBlink())})},t.prototype.updateCommandsToSkipShell=function(){var e=this;this.terminalInstances.forEach(function(t){t.setCommandsToSkipShell(e.configurationHelper.getCommandsToSkipShell())})},t.prototype.focus=function(){var e=this.terminalService.getActiveTerminalIndex();e!==-1&&this.terminalInstances.length>0&&this.terminalInstances[e].focus(!0)},t.prototype.dispose=function(){for(this.toDispose=s.dispose(this.toDispose);this.terminalInstances.length>0;)this.terminalInstances.pop().dispose();e.prototype.dispose.call(this)},t=i([r(0,v.ITelemetryService),r(1,h.IConfigurationService),r(2,p.IContextMenuService),r(3,u.IInstantiationService),r(4,f.IKeybindingService),r(5,b.IWorkspaceContextService),r(6,y.ITerminalService),r(7,x.IThemeService),r(8,d.IMessageService)],t)}(S.Panel);t.TerminalPanel=D})}).call(this);
//# sourceMappingURL=https://ticino.blob.core.windows.net/sourcemaps/66f37fd2a99eb9d628dd374d81d78835b410c39b/vs\workbench\parts\terminal\electron-browser\terminalPanel.js.map
